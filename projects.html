<!DOCTYPE html>
<html>
    <head>
        <title>My projects</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./static/styles/structure.css?1">
        <link rel="stylesheet" type="text/css" href="./static/styles/projects.css?1">
    </head>

    <body>
        <header>
            <div class="outset header header-top">
                <div class="header-text">
                    Luka Huibers /// HappyHoLuka
                </div>
                <div class="inset header-clock doto-lcd-font">
                    <div class="clock">XX XX</div>
                    <div class="clock">X-XXX-XXXX</div>
                </div>
            </div>
            <div class="header-buttons">
                <a class="outset base-button small" href="./index.html">
                    <div class="button-text">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                            <path d="M160-290h560v-380H160v380Zm0 80q-33 0-56.5-23.5T80-290v-380q0-33 23.5-56.5T160-750h560q33 0 56.5 23.5T800-670v90h20q25 0 42.5 17.5T880-520v80q0 26-17.5 43T820-380h-20v90q0 33-23.5 56.5T720-210H160Z"/>
                        </svg>
                        Home
                    </div>
                </a>
                <div class="outset base-button small selected">
                    <div class="button-text">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                            <path d="M160-210q-33 0-56.5-23.5T80-290v-380q0-33 23.5-56.5T160-750h560q33 0 56.5 23.5T800-670v90h20q25 0 42.5 17.5T880-520v80q0 26-17.5 43T820-380h-20v90q0 33-23.5 56.5T720-210H160Z"/>
                        </svg>
                        Projects
                    </div>
                </div>
                <a class="outset base-button small" href="./about.html">
                    <div class="button-text">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                            <path d="M160-290h560v-380H160v380Zm0 80q-33 0-56.5-23.5T80-290v-380q0-33 23.5-56.5T160-750h560q33 0 56.5 23.5T800-670v90h20q25 0 42.5 17.5T880-520v80q0 26-17.5 43T820-380h-20v90q0 33-23.5 56.5T720-210H160Z"/>
                        </svg>
                        About
                    </div>
                </a>
                <a class="outset base-button small" href="./blog.html">
                    <div class="button-text">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                            <path d="M160-290h560v-380H160v380Zm0 80q-33 0-56.5-23.5T80-290v-380q0-33 23.5-56.5T160-750h560q33 0 56.5 23.5T800-670v90h20q25 0 42.5 17.5T880-520v80q0 26-17.5 43T820-380h-20v90q0 33-23.5 56.5T720-210H160Z"/>
                        </svg>
                        Blog
                    </div>
                </a>
                <a class="outset base-button small" href="./guestbook.html">
                    <div class="button-text">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                            <path d="M160-290h560v-380H160v380Zm0 80q-33 0-56.5-23.5T80-290v-380q0-33 23.5-56.5T160-750h560q33 0 56.5 23.5T800-670v90h20q25 0 42.5 17.5T880-520v80q0 26-17.5 43T820-380h-20v90q0 33-23.5 56.5T720-210H160Z"/>
                        </svg>
                        Guestbook
                    </div>
                </a>
                <div class="outset header-buttons-stretch"></div>
            </div>
        </header>
        
        <div class="overlay" id="overlay_">
            <div class="outset window">
                <div class="window-top">
                    <div class="window-title" id="window-title">Title</div>
                    <button class="outset base-button exit" onclick="disableOverlay()">X</button>
                </div>
                <div class="window-text" id="window-text">Text</div>
                <div class="window-content">
                    <div class="sudoku-grid">
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 0,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 1,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 2,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 0,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 1,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 2,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 0,2, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 1,2, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(0, 2,2, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 3,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 4,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 5,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 3,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 4,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 5,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 3,2, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 4,2, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(1, 5,2, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 6,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 7,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 8,0, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 6,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 7,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 8,1, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 6,2, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 7,2, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(2, 8,2, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 0,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 1,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 2,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 0,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 1,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 2,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 0,5, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 1,5, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(3, 2,5, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 3,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 4,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 5,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 3,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 4,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 5,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 3,5, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 4,5, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(4, 5,5, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 6,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 7,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 8,3, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 6,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 7,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 8,4, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 6,5, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 7,5, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(5, 8,5, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 0,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 1,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 2,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 0,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 1,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 2,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 0,8, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 1,8, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(6, 2,8, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 3,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 4,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 5,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 3,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 4,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 5,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 3,8, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 4,8, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(7, 5,8, this)"></div>
                        </div>
                        <div class="sudoku-nine">
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 6,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 7,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 8,6, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 6,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 7,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 8,7, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 6,8, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 7,8, this)"></div>
                            <div class="inset sudoku-field" onclick="sudokuClick(8, 8,8, this)"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <main class="outset">
            <div class="text-contents">
                <p>These are the projects I am working on or have worked on in the past. 
                    The colour of the top right block on each project indicates the progress or 
                    state of the project. Green represents it is finished, orange represents it 
                    is currently being worked on, and red represents that it only yet exists as 
                    a concept. </p>
            </div>
            
            <div class="grid-projects">
                <div class="outset project" id="1">
                    <div class="project-top">
                        <div class="inset project-title">
                            Project 1: a personal website
                        </div>
                        <div class="outset project-progress todo"></div>
                    </div>
                    <div class="inset">
                        <div class="project-info doto-lcd-font" contenteditable=true>
                            SA website via Github Pages (yes, this website) to show projects 
                            Sthat I am working on. In the future, this website will also contain 
                            Sa blog and a guestbook, among other things.
                        </div>
                    </div>
                    <button class="outset base-button project" onclick="enableOverlay(1)">
                        <div class="button-text">
                            View project
                        </div>
                    </button>
                </div>
    
                <div class="outset project" id="2">
                    <div class="project-top">
                        <div class="inset project-title">
                            Project 2: Sudoku puzzle generator
                        </div>
                        <div class="outset project-progress todo"></div>
                    </div>
                    <div class="inset">
                        <div class="project-info doto-lcd-font">
                            S...
                        </div>
                    </div>
                    <button class="outset base-button project" onclick="enableOverlay(2)">
                        <div class="button-text">
                            View project
                        </div>
                    </button>
                </div>
    
                <div class="outset project" id="3">
                    <div class="project-top">
                        <div class="inset project-title">
                            TITLE
                        </div>
                        <div class="outset project-progress concept"></div>
                    </div>
                    <div class="inset">
                        <div class="project-info-animate doto-lcd-font">
                        </div>
                    </div>
                    <button class="outset base-button project" onclick="enableOverlay(3)">
                        <div class="button-text">
                            View project
                        </div>
                    </button>
                </div>

                <!-- <div class="outset project" id="4">
                    <div class="project-top">
                        <div class="inset project-title">
                            TITLE
                        </div>
                        <div class="outset project-progress concept"></div>
                    </div>
                    <div class="inset">
                        <div class="project-info doto-lcd-font">
                            SINFO
                        </div>
                    </div>
                    <a class="outset base-button project" href="#4">
                        <div class="button-text">
                            View project
                        </div>
                    </a>
                </div> -->

                <!-- <div class="outset project" id="5">
                    <div class="project-top">
                        <div class="inset project-title">
                            TITLE
                        </div>
                        <div class="outset project-progress concept"></div>
                    </div>
                    <div class="inset">
                        <div class="project-info doto-lcd-font">
                            SINFO
                        </div>
                    </div>
                    <a class="outset base-button project" href="#5">
                        <div class="button-text">
                            View project
                        </div>
                    </a>
                </div> -->
            </div>
        </main>

        <!-- <footer class="outset"></footer> -->
    </body>

    <script src="static/js/clock.js"></script>
    <script>
        //===================================================//
        //====================[ OVERLAY ]====================//
        //===================================================//

        const overlay = document.getElementById('overlay_');
        function enableOverlay(project) {
            overlay_.style.display = "block";
            let overlayTitle = `Project ${project}: `;
            let overlayText = "";
            switch (parseInt(project)) {
                case 1: // Personal Website
                    overlayTitle += "a personal website";
                    overlayText = "The goal of this project was to create a website via Github Pages to show (and host) \
                        projects that I make. I am currently busy making the actual website, but it already contains a (still \
                        not working) sudoku game. ";
                    break;
                case 2: // Sudoku
                    overlayTitle += "Sudoku";
                    overlayText = "For this project, I am making the game of Sudoku via Javascript. The goal of the project \
                        is to have a playable version of Sudoku where games are automatically generated to play, and you can \
                        check whether you completed the puzzle succesfully. ";
                    overlay.getElementsByClassName('sudoku-grid')[0].style.display = "grid";
                    break;
                default: 
                    overlayTitle += "TODO";
                    overlayText = "TODO";
            }
            overlay.querySelector('#window-title').innerHTML = overlayTitle;
            overlay.querySelector('#window-text').innerHTML = overlayText;
            document.getElementsByTagName('body')[0].style.overflow = 'hidden';
        }

        // Disable the project overlay and return to the overview
        function disableOverlay() {
            overlay.style.display = 'none';
            overlay.getElementsByClassName('sudoku-grid')[0].style.display = 'none';
            document.getElementsByTagName('body')[0].style.overflow = 'inherit';
        }

        // On nagivation change (url#projectNr), parse the url to open the correct project
        // window.navigation.addEventListener("navigate", (event) => {
        //     console.log("NAVIGATION EVENT CALLED")
        //     var project = event.destination.url.split('#')[1];
        //     if (project) {
        //         var projectNr = project.substring(project.length-1, project.length);
        //         enableOverlay(projectNr);
        //     } else {
        //         disableOverlay();
        //     }
        // })
        // On window load open the selected project (if any is selected)
        var project = document.URL.split('#')[1];
        if (project) {
            var projectNr = project.substring(project.length-1, project.length);
            enableOverlay(projectNr);
        }

        // const projects = document.getElementsByClassName('project');
        // function randomiseProjectLocs() {
        //     for (let i = 0; i < projects.length; i++) {
        //         let project = projects[i];
        //         project.style.marginLeft = (Math.random()*2-1)*10 + '%';
        //         project.style.marginright = (Math.random()*2-1)*10 + '%';
        //         // project.style.marginRight = '10%';
        //     }
        // }
        // randomiseProjectLocs();


        //==================================================//
        //====================[ SUDOKU ]====================//
        //==================================================//

        var selectedField;
        function sudokuClick(block, x, y, el) {
            if(el.selected != 'true') {
                // SELECT
                el.style.backgroundColor = 'black';
                el.selected = 'true';
            }
            else {
                // DESELECT
                el.style.backgroundColor = 'var(--color-bg)';
                el.selected = 'false';
            }
        }

        function propagateRows(curSubgrid, curIndex, grid) {
            let row = Math.floor(curIndex/3) * 3; // 0,1,2 => 0 and 3,4,5 => 3 and 6,7,8 => 6
            let rowSubgrids = [[0,1,2],[3,4,5],[6,7,8]].splice(Math.floor(subgrid/3), 1)[0]; // if subgrid is 1, returns [0,2]
            // rowSubgrids.splice(Math.floor(subgrid/3), 1); 
            for (let j = 0; j < 2; j++) { // other subgrid
                for (let k = 0; k < 3; k++) { // row index
                    let remainingValues = grid[rowSubgrids[j]][row+k];
                    let ind = remainingValues.indexOf(chosenValue);
                    if (ind >= 0){
                        grid[rowSubgrids[j]][row+k].splice(ind, 1);
                    }
                }
            }
        }

        function propagateColumns(curSubgrid, curIndex) {

        }

        const sudokuFields = document.getElementsByClassName('sudoku-field');
        function generateSudoku(seed) {
            // Step 1: make a 9x9 grid with each field having 1-9 as possible values
            let grid = new Array(9);
            for (let i = 0; i < 9; i++) {
                grid[i] = new Array(9);
                for (let j = 0; j < 9; j++) {
                    grid[i][j] = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                }
            }

            // Step 2: fill 1st, 5th, and 9th subgrid randomly (as these do not interfere with eachother)
            for (let subgrid of [0, 4, 8]) {
                let possibleValues = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                for (let i = 0; i < 9; i++) {
                    let randomIndex  = parseInt(Math.random() * (possibleValues.length-1));
                    let chosenValue = possibleValues.splice(randomIndex, 1)[0];
                    grid[subgrid][i] = chosenValue;
                    // Propagate this value to this column and row
                    let row = Math.floor(i/3) * 3; // 0,1,2 => 0 and 3,4,5 => 3 and 6,7,8 => 6
                    let rowSubgrids = [[0,1,2],[3,4,5],[6,7,8]].splice(Math.floor(subgrid/3), 1)[0]; // if subgrid is 1, returns [0,2]
                    rowSubgrids.splice(Math.floor(subgrid/3), 1); 
                    for (let j = 0; j < 2; j++) { // other subgrid
                        for (let k = 0; k < 3; k++) { // row index
                            let remainingValues = grid[rowSubgrids[j]][row+k];
                            let ind = remainingValues.indexOf(chosenValue);
                            if (ind >= 0){
                                grid[rowSubgrids[j]][row+k].splice(ind, 1);
                            }
                        }
                    }
                    let column = i % 3;
                    let columnSubgrids = [[0,3,6],[1,4,7],[2,5,8]].splice(subgrid % 3, 1)[0]; // if subgrid is 1, returns [4,7]
                    columnSubgrids.splice(subgrid % 3, 1);
                    for (let j = 0; j < 2; j++) { // other subgrid
                        for (let k = 0; k < 3; k++) { // column index
                            let remainingValues = grid[columnSubgrids[j]][column+k*3];
                            let ind = remainingValues.indexOf(chosenValue);
                            if (ind >= 0){
                                grid[columnSubgrids[j]][column+k*3].splice(ind, 1);
                            }
                        }
                    }
                }
            }


            // Step 2: fill in the entire puzzle and save it as the solution
            for (let i = 0; i < sudokuFields.length; i++) {
                let subgrid = parseInt(i/9) % 9;
                let index = i % 9;
                let val = grid[subgrid][index];

                if (!Array.isArray(val)) { sudokuFields[i].innerHTML = val; }
                else { 
                    sudokuFields[i].style.fontSize = '7px';
                    sudokuFields[i].innerHTML = val;
                }
            }
            // console.log(grid);

            // Step 3: iteratively remove numbers on fields that can only have 
            //         that one number until this is no longer possible
        }
        generateSudoku(1);

        //=======================================================//
        //====================[ LCD SCREENS ]====================//
        //=======================================================//

        // Make the text on the LCD screen of each project be "typed"
        function writeText(el){
            let elementText = el.innerHTML;
            elementText = elementText.replace(/^\s+S|\n\s+S|\s+$/g, '').replace(/\\\s/g, '\n');
            el.innerHTML = "";

            const textLength = elementText.length;
            let i = 0;
            const writter = setInterval(() => {
                if ( i === textLength+1 ) {
                    clearInterval(writter);
                } else {
                    el.innerHTML = elementText.substring(0, i++);
                }
            }, 20)
        }
        var lcdTexts = document.getElementsByClassName("project-info");
        for (let i = 0; i < lcdTexts.length; i++) {
            let el = lcdTexts[i];
            writeText(el);
        }

        // Animate the face visible on one of the project descriptions
        const faceStates = [
            " /--------\\ \n |        |\n | O    O |\n |        |\n | \\____/ |\n \\--------/",
            " /--------\\ \n |        |\n | O    O |\n |        |\n | \\____/ |\n \\--------/",
            " /--------\\ \n |        |\n | O    O |\n |        |\n | \\____/ |\n \\--------/",
            " /--------\\ \n |        |\n | O    O |\n |        |\n | \\____/ |\n \\--------/",
            " /--------\\ \n |        |\n | -    O |\n |        |\n | \\____/ |\n \\--------/",
            " /--------\\ \n |        |\n | -    - |\n |        |\n | \\____/ |\n \\--------/",
            " /--------\\ \n |        |\n | O    - |\n |        |\n | \\____/ |\n \\--------/",
        ]
        function animateFace(el) {
            const faceStatesLength = faceStates.length;
            let i = 0;
            const writter = setInterval(() => {
                // let text = 
                el.innerHTML = faceStates[i];
                i = (i+1) % faceStatesLength;
            }, 200)
        }
        var lcdAnimate = document.getElementsByClassName("project-info-animate")[0];
        animateFace(lcdAnimate);
    </script>
</html>